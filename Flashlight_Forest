from cmu_graphics import *

#Player variables
class moveableCharacter():
    def __init__(self, cx, cy, dx = 0, dy = 0, r = 5):
        self.cx = cx
        self.cy = cy
        self.dx = dx
        self.dy = dy
        self.r = r
        

def onAppStart(app):
    #Player variables
    app.player = moveableCharacter(200, 200)
    app.movementCoefficient = 3
    #Board variables
    app.rows = 15
    app.cols = 15
    app.boardLeft = 50
    app.boardTop = 75
    app.boardWidth = 300
    app.boardHeight = 300
    app.cellBorderWidth = 0.5

def redrawAll(app):
    #Draw the player
    drawCircle(app.player.cx, app.player.cy, app.player.r)
    #Draw the board
    drawLabel('Our second 2d board (this works!)', 200, 30, size=16)
    drawBoard(app)
    drawBoardBorder(app)


def onKeyHold(app, key):
    if 'w' in key:
        app.player.dy = -1
    if 's' in key:
        app.player.dy = 1
    if 'w' in key and 's' in key:
        app.player.dy = 0
    if 'a' in key:
        app.player.dx = -1
    if 'd' in key:
        app.player.dx = 1
    if 'a' in key and 'd' in key:
        app.player.dx = 0

def onKeyRelease(app, key):
    if key == 'w' or key == 's':
        app.player.dy = 0
    if key == 'a' or key == 'd':
        app.player.dx = 0

def onStep(app):
    app.player.cy += app.player.dy * app.movementCoefficient
    app.player.cx += app.player.dx * app.movementCoefficient
    if app.player.cy + app.player.r > app.height:
        app.player.cy = app.height - app.player.r
    if app.player.cx + app.player.r > app.width:
        app.player.cx = app.width - app.player.r
    if app.player.cy - app.player.r < 0:
        app.player.cy = app.player.r
    if app.player.cx - app.player.r < 0:
        app.player.cx = app.player.r

def drawBoard(app):
    for row in range(app.rows):
        for col in range(app.cols):
            drawCell(app, row, col)

def drawBoardBorder(app):
  # draw the board outline (with double-thickness):
  drawRect(app.boardLeft, app.boardTop, app.boardWidth, app.boardHeight,
           fill=None, border='black',
           borderWidth=2*app.cellBorderWidth)

def drawCell(app, row, col):
    cellLeft, cellTop = getCellLeftTop(app, row, col)
    cellWidth, cellHeight = getCellSize(app)
    drawRect(cellLeft, cellTop, cellWidth, cellHeight,
             fill=None, border='black',
             borderWidth=app.cellBorderWidth)

def getCellLeftTop(app, row, col):
    cellWidth, cellHeight = getCellSize(app)
    cellLeft = app.boardLeft + col * cellWidth
    cellTop = app.boardTop + row * cellHeight
    return (cellLeft, cellTop)

def getCellSize(app):
    cellWidth = app.boardWidth / app.cols
    cellHeight = app.boardHeight / app.rows
    return (cellWidth, cellHeight)

def main():
    runApp()
    
main()